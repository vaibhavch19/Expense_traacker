{% extends "base.html" %}
{% block content %}
<h2>Dashboard</h2>

<form method="get" action="{{ url_for('dashboard') }}">
    <label for="category">Filter by Category:</label>
    <select name="category" id="category">
        <option value="all">All Categories</option>
        {% for c in categories %}
        <option value="{{ c.id }}">{{ c.name }}</option>
        {% endfor %}
    </select>

    <label for="month">Filter by Month:</label>
    <input type="month" id="month" name="month" />

    <button type="submit" class="btn">Filter</button>
</form>

<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Description</th>
      <th>Category</th>
      <th>Amount (₹)</th>
      <th>Receipt</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for e in expenses %}
    <tr>
      <td>{{ e.date.strftime('%Y-%m-%d') }}</td>
      <td>{{ e.description }}</td>
      <td>{{ e.category.name if e.category else "" }}</td>
      <td>₹{{ '%.2f'|format(e.amount) }}</td>
      <td>
        {% if e.receipt_path %}
          <a href="{{ url_for('receipt_image', filename=e.receipt_path) }}" target="_blank">
            <img src="{{ url_for('receipt_image', filename=e.receipt_path) }}" alt="Receipt"
                 style="height:38px; border-radius:6px; border:1px solid #eee;">
          </a>
        {% else %}
          <span style="color:#888;">—</span>
        {% endif %}
      </td>
      <td>
        <div class="action-btns">
          <form action="{{ url_for('edit_expense', expense_id=e.id) }}" method="get" style="display:inline;">
            <button type="submit" class="btn edit-btn">Edit</button>
          </form>

          <form method="POST" action="{{ url_for('delete_expense', expense_id=e.id) }}" style="display:inline;"
                onsubmit="return confirm('Are you sure you want to delete this expense?');">
            <button type="submit" class="btn delete-btn">Delete</button>
          </form>
        </div>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="6" style="text-align:center; color:#666;">No expenses found. Add some!</td></tr>
    {% endfor %}
  </tbody>
</table>

<h3>Monthly Budget Summary ({{ current_month }})</h3>
<ul>
  {% for cat, info in budget_feedback.items() %}
    <li class="flash {{ info.status }}">{{ info.msg }}</li>
  {% else %}
    <li>No budget data available for current month.</li>
  {% endfor %}
</ul>

{% endblock %}
